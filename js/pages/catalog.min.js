"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,c=[],s=!0,l=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){l=!0,o=t}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var r,n,o,a,i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return n=!(r=!0),{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){n=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(n)throw o}}};if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return i&&(t=i),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var r;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(r="Object"===(r=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _regeneratorRuntime(){_regeneratorRuntime=function(){return i};var s,i={},t=Object.prototype,l=t.hasOwnProperty,u=Object.defineProperty||function(t,e,r){t[e]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function a(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(s){a=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o,a,i,c,e=e&&e.prototype instanceof v?e:v,e=Object.create(e.prototype),n=new S(n||[]);return u(e,"_invoke",{value:(o=t,a=r,i=n,c=f,function(t,e){if(c===h)throw new Error("Generator is already running");if(c===y){if("throw"===t)throw e;return{value:s,done:!0}}for(i.method=t,i.arg=e;;){var r=i.delegate;if(r){r=function t(e,r){var n=r.method,o=e.iterator[n];if(o===s)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=s,t(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;n=d(o,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,g;o=n.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=s),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}(r,i);if(r){if(r===g)continue;return r}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(c===f)throw c=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);c=h;r=d(o,a,i);if("normal"===r.type){if(c=i.done?y:p,r.arg===g)continue;return{value:r.arg,done:i.done}}"throw"===r.type&&(c=y,i.method="throw",i.arg=r.arg)}})}),e}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}i.wrap=c;var f="suspendedStart",p="suspendedYield",h="executing",y="completed",g={};function v(){}function m(){}function _(){}var e={},b=(a(e,n,function(){return this}),Object.getPrototypeOf),b=b&&b(b(T([]))),w=(b&&b!==t&&l.call(b,n)&&(e=b),_.prototype=v.prototype=Object.create(e));function P(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function L(i,c){var e;u(this,"_invoke",{value:function(r,n){function t(){return new c(function(t,e){!function e(t,r,n,o){var a,t=d(i[t],i,r);if("throw"!==t.type)return(r=(a=t.arg).value)&&"object"==_typeof(r)&&l.call(r,"__await")?c.resolve(r.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):c.resolve(r).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)});o(t.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}})}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function T(e){if(e||""===e){var r,t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return r=-1,(t=function t(){for(;++r<e.length;)if(l.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=s,t.done=!0,t}).next=t}throw new TypeError(_typeof(e)+" is not iterable")}return u(w,"constructor",{value:m.prototype=_,configurable:!0}),u(_,"constructor",{value:m,configurable:!0}),m.displayName=a(_,o,"GeneratorFunction"),i.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,a(t,o,"GeneratorFunction")),t.prototype=Object.create(w),t},i.awrap=function(t){return{__await:t}},P(L.prototype),a(L.prototype,r,function(){return this}),i.AsyncIterator=L,i.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var a=new L(c(t,e,r,n),o);return i.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},P(w),a(w,o,"Generator"),a(w,n,function(){return this}),a(w,"toString",function(){return"[object Generator]"}),i.keys=function(t){var e,r=Object(t),n=[];for(e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},i.values=T,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=s)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return a.type="throw",a.arg=r,n.next=t,e&&(n.method="next",n.arg=s),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=l.call(o,"catchLoc"),c=l.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&l.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var a=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r,n,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(r=o.completion).type&&(n=r.arg,A(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:T(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=s),g}},i}function asyncGeneratorStep(t,e,r,n,o,a,i){try{var c=t[a](i),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function _asyncToGenerator(c){return function(){var t=this,i=arguments;return new Promise(function(e,r){var n=c.apply(t,i);function o(t){asyncGeneratorStep(n,e,r,o,a,"next",t)}function a(t){asyncGeneratorStep(n,e,r,o,a,"throw",t)}o(void 0)})}}window._PRODUCTS_PER_PAGE||console.error("There is no variable number of products on the Catalog page! Should to add variable as window._PRODUCTS_PER_PAGE=10");var RERENDER_PROD_TIMEOUT_DELAY=1e3,setProdUrlParam=function(t,e,r){var n=window.location.href;-1!==n.indexOf("".concat(r,"[").concat(t,"]="))?n="reset"===e?n.replace(new RegExp("(".concat(r,"\\[").concat(t,"\\]=)[^&]+")),""):n.replace(new RegExp("(".concat(r,"\\[").concat(t,"\\]=)[^&]+")),"$1".concat(e)):n+=(-1!==n.indexOf("?")?"&":"?").concat(r,"[").concat(t,"]=").concat(e),n=(n=(n=(n=(n="filter"!==r&&"sort"!==r?n:n.replace(/&?select\[page\]=[^&]*/g,"")).replace(/&+/g,"&")).replace(/\?&/g,"?")).replace(/&$/g,"")).replace(/\?$/,""),n=decodeURIComponent(n),window.history.pushState({},"",n),processProdData(n)},initDefaultProdCatalog=function(){window._CATALOG||(window._CATALOG={})},requestProductData=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e,r;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return window._CATALOG=[],t.next=3,fetch("https://anaragaev.github.io/technolight.layout/mocks/products.json");case 3:if((e=t.sent).ok)return t.next=7,e.json();t.next=12;break;case 7:"data"in(r=t.sent)?window._CATALOG=r.data:console.error("В запрошенных данных каталога нет объекта с данными! Предполагается наличие свойства с data."),0===window._CATALOG.length&&console.error("Пришел пустой объкт с данными!"),t.next=13;break;case 12:console.error("Ошибка запроса каталога товаров! Код ошибки:",e.status);case 13:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),checkProductResetAllButton=function(){var t=Array.from(document.querySelectorAll(".filters__options.checked")),e=document.querySelector(".filters__reset");0<t.length?e.classList.remove("disabled"):e.classList.add("disabled")},undroppProductFilterLists=function(t){t.forEach(function(t){t.classList.remove("dropped"),setTimeout(function(){return t.classList.remove("active")},300)})},resetAllProductsFilters=function(t){var e=t.closest(".page-catalog .filters"),r=e.querySelectorAll(".filters__list .filters__item"),n=Array.from(document.querySelectorAll(".page-catalog .filters__options")),e=Array.from(e.querySelectorAll('input[type="radio"]:not([value="reset"]'));undroppProductFilterLists(r),n.forEach(function(t){return t.classList.remove("checked")}),e.forEach(function(t){return t.checked=!1}),t.closest(".filters__reset").classList.add("disabled")},removeFilterParamFromCatalogUrl=function(t,e){e="".concat(e,"[^&]*"),e=new RegExp(e,"g");return t.replace(e,"")},initCatalogFilterReset=function(){var t=document.querySelector(".page-catalog .filters__reset .filters__item");t&&t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var t=JSON.parse(this.dataset.deletedParams),e=window.location.href;if(-1!==e.indexOf("?")){var r,n=_createForOfIteratorHelper(t);try{for(n.s();!(r=n.n()).done;)var o=r.value,e=removeFilterParamFromCatalogUrl(e,o)}catch(t){n.e(t)}finally{n.f()}e=(e=(e=(e=e.replace(/&+/g,"&")).replace(/\?&/g,"?")).replace(/&$/g,"")).replace(/\?$/,""),e=decodeURIComponent(e),window.history.pushState({},"",e),resetAllProductsFilters(this),processProdData(e)}})},initCatalogFilterControllers=function(){Array.from(document.querySelectorAll('.page-catalog .filters input[type="radio"]')).forEach(function(t){return t.addEventListener("change",function(t){t.preventDefault(),t.stopPropagation();t=this.closest(".filters__options");"reset"!==this.value?t.classList.add("checked"):t.classList.remove("checked"),setProdUrlParam(this.name,this.value,this.dataset.type),checkProductResetAllButton()})})},getCurrentPageNumberFromUrl=function(){var t=window.location.href;return new URLSearchParams(t.split("?")[1]).get("select[page]")},initCatalogPaginationControllers=function(){function n(){t.classList.add("disabled"),s.classList.add("disabled"),e.querySelector('[data-page="1"]').classList.add("active")}function o(){r.classList.add("disabled"),l.classList.add("disabled"),e.querySelector('[data-page="'.concat(i,'"]')).classList.add("active")}function a(t){1===parseInt(t)?n():parseInt(t)===i?o():e.querySelector('[data-page="'.concat(t,'"]')).classList.add("active")}var i=document.querySelectorAll(".page-catalog .pagination .pagination__btn_page").length,e=document.querySelector(".page-catalog .pagination"),c=Array.from(e.querySelectorAll(".page-catalog .pagination button")),t=e.querySelector('[data-page="first"]'),r=e.querySelector('[data-page="last"]'),s=e.querySelector('[data-page="prev"]'),l=e.querySelector('[data-page="next"]');c.forEach(function(t){return t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var e=getCurrentPageNumberFromUrl(),r=this.dataset.page;switch(c.forEach(function(t){return t.classList.remove("disabled","active")}),r){case"first":r=1,n();break;case"last":r=i,o();break;case"prev":a(r=e-1);break;case"next":r=e?parseInt(e)+1:2,a(r);break;default:a(r)}r!==e&&setProdUrlParam("page",r,"select")})})},parseProdUrl=function(t){var n={},t=t.split("?")[1];return t&&t.split("&").forEach(function(t){var e,t=_slicedToArray(t.split("="),2),r=t[0],t=t[1];r.includes("[")&&(e=(r=_slicedToArray(r.split("["),2))[0],r=r[1].slice(0,-1),n[e]||(n[e]={}),n[e][r]=t)}),n},updateProdPagination=function(t,e,r){for(var n=document.querySelector(".page-catalog .pagination"),o=1===e?"disabled":"",a=e===(r=Math.ceil(t/window._PRODUCTS_PER_PAGE))?"disabled":"",i="",i=(i+='<button class="pagination__extremum '.concat(o,'" href="" data-page="first">первая</button>'))+'<button class="pagination__btn pagination__btn_prev '.concat(o,'" href="" data-page="prev"><i></i></button>'),c=1;c<=r;c++)i+='<button class="pagination__btn pagination__btn_page '.concat(e===c?"active":"",'" href="" data-page="').concat(c,'">').concat(c,"</button>");i=(i+='<button class="pagination__btn pagination__btn_next '.concat(a,'" href="" data-page="next"><i></i></button>'))+'<button class="pagination__extremum '.concat(a,'" href="" data-page="last">последняя</button>'),n.classList.add("blocked"),setTimeout(function(){0===t?n.classList.add("hide"):(n.classList.remove("hide"),n.innerHTML=i,initCatalogPaginationControllers(),n.classList.remove("blocked"))},RERENDER_PROD_TIMEOUT_DELAY)},filterProdData=function(t,e){if(!t)return e;var r,n=e;for(r in t)!function(e){var r=t[e];"Не указан"!==r&&"Не указано"!==r&&"Не указана"!==r&&"Без категории"!==r||(r=""),n=n.filter(function(t){return Array.isArray(t[e])?""===r?0===t[e].length:t[e].includes(r):t[e]===r})}(r);return console.log("after FILTER",n),console.log("FILTER --------------------------------------------------------"),n},sortProdData=function(t,e){if(!t)return e;var r,o=e;for(r in t)!function(r){var n=t[r];o=o.sort(function(t,e){return"По возрастанию"===n?t[r]-e[r]:e[r]-t[r]})}(r);return console.log("after SORT",o),console.log("SORT -------------------------------------------------------------"),o},getPageFromProdData=function(t,e){var r=e,t=t&&t.page&&""!==t.page?parseInt(t.page):1,n=Math.ceil(r.length/window._PRODUCTS_PER_PAGE),o=((t=n<(t=t<1?1:t)?n:t)-1)*window._PRODUCTS_PER_PAGE,a=o+window._PRODUCTS_PER_PAGE,r=r.slice(o,a);return console.log("after get PAGE",r),console.log("GET PAGE --------------------------------------"),updateProdPagination(e.length,t,n),r},sortProdByCategory=function(t){var e,r={},n=_createForOfIteratorHelper(t);try{for(n.s();!(e=n.n()).done;){var o=e.value,a=o.category[0];(a=a||"Без категории")in r||(r[a]=[]),r[a].push(o)}}catch(t){n.e(t)}finally{n.f()}return console.log("after replaced By Category",r),console.log("Replaced By Category --------------------------------------"),r},buildProductListLayout=function(t){var e,r="";for(e in t){var n,o="",a=(o+='\n            <section class="section section_product-list">\n                <div class="product-item__container">\n                    <div class="container container_caption">\n                        <div class="row">\n                            <div class="col col-xl-8">\n                                <h2 class="container_caption-text">'.concat(e,'</h2>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="product-item__list">\n                        <div class="container">\n                            <div class="row">'),_createForOfIteratorHelper(t[e]));try{for(a.s();!(n=a.n()).done;){var i=n.value,c=i.tags,s="",l=(!Array.isArray(c)&&Object.keys(c)&&(s+='<div class="product-item__badge-list">',c.new&&(s+='<span class="product-item__badge-item">Новинка</span>'),c.IP&&(s+='<span class="product-item__badge-item product-item__badge-item_waterproof">IP 44<i></i></span>'),s+="</div>"),i.price?i.price+" ₽":"");o+='\n                    <div class="col-12 col-sm-6 col-md-4 col-xl-3">\n                        <div class="product-item__card">\n                            <a class="product-item__body" href="#" title="'.concat(i.title,'">\n                                ').concat(s,'\n                                <div class="product-item__pic">\n                                    <img src="').concat(i.image,'" alt="" loading="lazy">\n                                    <button class="product-item__favorites"\n                                        type="button"\n                                        data-product-id="').concat(i.article,'"\n                                        data-title="').concat(i.title,'"\n                                        data-message="Добавлен в избранное"></button>\n                                </div>\n                                <div class="product-item__content">\n                                    <div class="product-item__desc">\n                                        <span class="product-item__code">').concat(i.article,'</span>\n                                        <p class="product-item__name">').concat(i.title,'</p>\n                                    </div>\n                                    <div class="product-item__buy">\n                                        <span class="product-item__price">').concat(l,'</span>\n                                        <button class="product-item__cart"\n                                            type="button"\n                                            data-product-id="').concat(i.article,'"\n                                            data-title="').concat(i.title,'"\n                                            data-message="Добавлен в корзину">\n                                        </button>\n                                    </div>\n                                </div>\n                            </a>\n                        </div>\n                    </div>')}}catch(t){a.e(t)}finally{a.f()}r+=o+="\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>"}return r},buildNoProductListMsgLayout=function(){return'\n        <section class="section section_product-list">\n            <div class="description__msg display visible">\n                <div class="container">\n                    <span>К сожалению, по Вашему запросу ничего не найдено. Товара с данными параметрами нет.</span>\n                </div>\n            </div>\n        </section>\n    '},updateProductListOnPage=function(t){window.spinner.show();var e=0===Object.keys(t).length?buildNoProductListMsgLayout():buildProductListLayout(t),r=Array.from(document.querySelectorAll(".page-catalog .section_product-list"));r.forEach(function(t){return t.classList.add("blocked")}),setTimeout(function(){r.forEach(function(t){return t.parentNode.removeChild(t)}),document.querySelector(".page-catalog .section_filter").insertAdjacentHTML("afterend",e),smoothScrollTo(0,1e3),initAddToFavorites(),initAddToCart(),window.spinner.hide(),showAnimElements()},RERENDER_PROD_TIMEOUT_DELAY)},processProdData=function(t){t=parseProdUrl(t);console.log("manipulationDataObj",t),updateProductListOnPage(sortProdByCategory(getPageFromProdData(t.select,sortProdData(t.sort,filterProdData(t.filter,window._CATALOG)))))};window.addEventListener("load",function(){document.querySelector(".page-catalog")&&(initCatalogFilterControllers(),initCatalogFilterReset(),initCatalogPaginationControllers(),initDefaultProdCatalog(),requestProductData())});